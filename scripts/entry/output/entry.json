{"AWSTemplateFormatVersion": "2010-09-09", "Parameters": {"ProjectName": {"Type": "String"}, "Bucket": {"Type": "String", "Default": "a2c-qs-assets"}, "BucketKey": {"Type": "String", "Default": "ast-jjen/functions/packages/ConfigParser/lambda.zip"}, "MainStackParams": {"Type": "String", "Default": "s3%3A%2F%2Fjjen-configurator-test%2Fmy_params.json"}, "MainStackTemplateUrl": {"Type": "String"}}, "Resources": {"ConfigParserRole": {"Type": "AWS::IAM::Role", "Properties": {"RoleName": "jjen-test-CustomResourceRole", "AssumeRolePolicyDocument": {"Statement": [{"Action": "sts:AssumeRole", "Effect": "Allow", "Principal": {"Service": "lambda.amazonaws.com"}}], "Version": "2012-10-17"}, "ManagedPolicyArns": [{"Fn::Sub": "arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"}], "Path": "/am-a2c/", "PermissionsBoundary": "arn:aws-us-gov:iam::016915823617:policy/Security_Boundary_NoIAM", "Policies": [{"PolicyDocument": {"Statement": [{"Action": "iam:GetRole", "Effect": "Allow", "Resource": "*"}], "Version": "2012-10-17"}, "PolicyName": "role-checker"}, {"PolicyName": "S3ReadAccess", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["s3:GetObject"], "Resource": "*"}]}}]}}, "ConfigParser": {"Type": "AWS::Lambda::Function", "Properties": {"FunctionName": {"Fn::Sub": "${ProjectName}-ConfigParser"}, "Handler": "config_parser.handler", "MemorySize": 256, "Timeout": 300, "Role": {"Fn::GetAtt": ["ConfigParserRole", "Arn"]}, "Runtime": "python3.9", "Code": {"S3Bucket": {"Ref": "Bucket"}, "S3Key": {"Ref": "BucketKey"}}}}, "Config": {"Type": "AWS::CloudFormation::CustomResource", "Properties": {"ServiceToken": {"Fn::GetAtt": ["ConfigParser", "Arn"]}, "MainStackParams": {"Ref": "MainStackParams"}}}, "MainStack": {"Type": "AWS::CloudFormation::Stack", "Properties": {"TemplateURL": {"Ref": "MainStackTemplateUrl"}, "Parameters": {"AITInstanceType": {"Fn::GetAtt": ["Config", "AITInstanceType"]}, "CloudWatchLogsRetentionPeriod": {"Fn::GetAtt": ["Config", "CloudWatchLogsRetentionPeriod"]}, "KeyPairName": {"Fn::GetAtt": ["Config", "KeyPairName"]}, "VPCCIDR": {"Fn::GetAtt": ["Config", "VPCCIDR"]}, "PublicSubnet1CIDR": {"Fn::GetAtt": ["Config", "PublicSubnet1CIDR"]}, "PublicSubnet2CIDR": {"Fn::GetAtt": ["Config", "PublicSubnet2CIDR"]}, "PublicSubnet3CIDR": {"Fn::GetAtt": ["Config", "PublicSubnet3CIDR"]}, "PrivateSubnet1CIDR": {"Fn::GetAtt": ["Config", "PrivateSubnet1CIDR"]}, "PrivateSubnet2CIDR": {"Fn::GetAtt": ["Config", "PrivateSubnet2CIDR"]}, "PrivateSubnet3CIDR": {"Fn::GetAtt": ["Config", "PrivateSubnet3CIDR"]}, "AvailabilityZones": {"Fn::GetAtt": ["Config", "AvailabilityZones"]}, "QSS3BucketName": {"Fn::GetAtt": ["Config", "QSS3BucketName"]}, "QSS3BucketRegion": {"Fn::GetAtt": ["Config", "QSS3BucketRegion"]}, "QSS3KeyPrefix": {"Fn::GetAtt": ["Config", "QSS3KeyPrefix"]}, "RemoteAccessCIDR": {"Fn::GetAtt": ["Config", "RemoteAccessCIDR"]}, "SSLCertificateArn": {"Fn::GetAtt": ["Config", "SSLCertificateArn"]}, "HostedZoneID": {"Fn::GetAtt": ["Config", "HostedZoneID"]}, "FQDN": {"Fn::GetAtt": ["Config", "FQDN"]}, "PermissionsBoundaryArn": {"Fn::GetAtt": ["Config", "PermissionsBoundaryArn"]}, "RolePath": {"Fn::GetAtt": ["Config", "RolePath"]}, "ProjectName": {"Fn::GetAtt": ["Config", "ProjectName"]}, "VpcId": {"Fn::GetAtt": ["Config", "VpcId"]}, "PublicSubnet1ID": {"Fn::GetAtt": ["Config", "PublicSubnet1ID"]}, "PublicSubnet2ID": {"Fn::GetAtt": ["Config", "PublicSubnet2ID"]}, "PrivateSubnet1AID": {"Fn::GetAtt": ["Config", "PrivateSubnet1AID"]}, "PrivateSubnet2AID": {"Fn::GetAtt": ["Config", "PrivateSubnet2AID"]}, "PrivateSubnet3AID": {"Fn::GetAtt": ["Config", "PrivateSubnet3AID"]}, "AccessSgID": {"Fn::GetAtt": ["Config", "AccessSgID"]}, "DeployIam": {"Fn::GetAtt": ["Config", "DeployIam"]}}}}}}